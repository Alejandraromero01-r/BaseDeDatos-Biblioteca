-- Vista de libros con sus autores y categor√≠as
CREATE OR REPLACE VIEW vista_libros_detalle AS
SELECT l.libro_id, l.titulo, l.anio_publicacion, l.editorial,
       STRING_AGG(DISTINCT a.nombre, ', ') AS autores,
       STRING_AGG(DISTINCT c.nombre, ', ') AS categorias
FROM Libros l
LEFT JOIN Libros_Autores la ON la.libro_id = l.libro_id
LEFT JOIN Autores a ON a.autor_id = la.autor_id
LEFT JOIN Libros_Categorias lc ON lc.libro_id = l.libro_id
LEFT JOIN Categorias c ON c.categoria_id = lc.categoria_id
GROUP BY l.libro_id, l.titulo, l.anio_publicacion, l.editorial;

